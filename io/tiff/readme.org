:PROPERTIES:
:header-args:lisp: :results verbatim :exports both :package mlx-user :eval no-export :dir (expand-file-name "../../")
:END:
#+title: MLX-CL/IO/TIFF
#+subtitle: Support TIFF file read and write
#+author: 凉凉
#+html_head: <!-- The documentation is generated on 11111000000/tao-theme-emacs (tao-yin) with org literal programming style.  -->
#+html_head: <!-- The Unifont is destributed on cdn.jsdelivr.net -->
#+html_head: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/unifont@5.2.5/index.min.css">
#+html_head: <style> body { font-size: 1.05em; background-color: #171717; color: #dadada } </style>
#+html_head: <style> pre, code { font-family: "Unifont", monospace; }</style>
#+html_head: <style> pre { background-color: #171717; } </style>
#+html_head: <style> a { display: inline-block; border: 1px solid; border-radius: 0px; border-color: #f6f6f6; text-decoration: none; color: #f6f6f6; padding: 1px; margin: 1px; } </style>
#+html_head: <style> a:hover { color: #0e0e0e; background-color: #c3c3c3 } </style>
#+html_head: <style> .title { padding-top: 100px; padding-bottom: 10px } </style>
* About
MLX-CL/IO/TIFF add support for reading and writing =mlx-array= from and to
TIFF file via [[https://github.com/slyrus/retrospectiff][slyrus/retrospectiff]].

*NOTE*: I'm considering using [[https://libtiff.gitlab.io/][libTIFF]] to replace [[https://github.com/slyrus/retrospectiff][slyrus/retrospectiff]].

* Usage
** Loading
#+begin_src lisp
  (ql:quickload :mlx-cl/io/tiff)
#+end_src

*NOTE*: if you load [[../../image/][=mlx-cl/image=]], it would automatically load
=mlx-cl/io/tiff= and other image file IO support.

** Reading TIFF file
#+begin_src lisp
  (mlx-array "xxx.tiff")
#+end_src

** Wrting TIFF file
#+header: :results file
#+header: :var size=200
#+begin_src lisp
    (destructuring-bind (x y)
        (meshgrid (linspace 0 1 size)
                  (linspace 0 1 size))
      (->* (stack x
                  y
                  (zeros-like x)
                  :axis 2)
        (as-dtype (* * 255) :uint8)
        (save * :output "./res/img/write-tiff-example.tif")))
#+end_src

#+RESULTS:
[[file:../../res/img/write-tiff-example.tif]]

*NOTE*: the original code is from [[https://thebookofshaders.com/03/][The Book of Shaders]]:

#+begin_src c
  #ifdef GL_ES
  precision mediump float;
  #endif

  uniform vec2 u_resolution;
  uniform vec2 u_mouse;
  uniform float u_time;

  void main() {
  	vec2 st = gl_FragCoord.xy/u_resolution;
  	gl_FragColor = vec4(st.x,st.y,0.0,1.0);
  }
#+end_src
