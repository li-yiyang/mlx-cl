<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-11-20 Thu 18:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MLX-CL.TUTORIAL.DRAWINGS</title>
<meta name="author" content="凉凉" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<!-- The documentation is generated on 11111000000/tao-theme-emacs (tao-yin) with org literal programming style.  -->
<!-- The Unifont is destributed on cdn.jsdelivr.net -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/unifont@5.2.5/index.min.css">
<style> body { font-size: 1.05em; background-color: #171717; color: #dadada } </style>
<style> pre, code { font-family: "Unifont", monospace; }</style>
<style> pre { background-color: #171717; } </style>
<style> a { display: inline-block; border: 1px solid; border-radius: 0px; border-color: #f6f6f6; text-decoration: none; color: #f6f6f6; padding: 1px; margin: 1px; } </style>
<style> a:hover { color: #0e0e0e; background-color: #c3c3c3 } </style>
<style> .title { padding-top: 100px; padding-bottom: 10px } </style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">MLX-CL.TUTORIAL.DRAWINGS
<br />
<span class="subtitle">Just draw something for fun</span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org7e1cef5">1. About</a></li>
<li><a href="#org04daa10">2. Waves</a>
<ul>
<li><a href="#org4842725">2.1. Wave on x-axis</a></li>
<li><a href="#org29b9c09">2.2. Matrix that performs rotation transformation</a></li>
<li><a href="#orgfa11f6f">2.3. Waves interference</a></li>
<li><a href="#org0f2b845">2.4. The Waves</a></li>
</ul>
</li>
<li><a href="#org88f9209">3. Equinox</a>
<ul>
<li><a href="#orgcfa060d">3.1. Linear \(\Vert \boldsymbol{r} \Vert\)</a></li>
<li><a href="#org18df6df">3.2. Sphere</a></li>
<li><a href="#org66ee64b">3.3. Lighting along y-axis</a></li>
<li><a href="#org9c8446a">3.4. The Equinox</a></li>
</ul>
</li>
<li><a href="#org83ebf35">4. Appendix</a>
<ul>
<li><a href="#orgb4c3bfd">4.1. Package</a>
<ul>
<li><a href="#org615b812">4.1.1. Utils</a></li>
<li><a href="#orgc7e17bf">4.1.2. Creating <code>mlx-array</code></a></li>
<li><a href="#org807a019">4.1.3. Normalize <code>mlx-array</code></a></li>
<li><a href="#org4e0a436">4.1.4. Arrows</a></li>
<li><a href="#org9cf9b45">4.1.5. FFMPEG</a></li>
</ul>
</li>
<li><a href="#org9a00f45">4.2. Reference</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org7e1cef5" class="outline-2">
<h2 id="org7e1cef5"><span class="section-number-2">1.</span> About</h2>
<div class="outline-text-2" id="text-1">
<p>
This is some trivial implementation and explanation of <a href="https://www.xordev.com/arsenal">XorDev's shader arts</a>. <sup><a id="fnr.a-sad-story" class="footref" href="#fn.a-sad-story" role="doc-backlink">1</a></sup>
To run the example codes, you should load the <a href="#orgb4c3bfd">package</a> and switch to
<code>mlx-cl.tutorial.drawings</code> package.
</p>
</div>
</div>
<div id="outline-container-org04daa10" class="outline-2">
<h2 id="org04daa10"><span class="section-number-2">2.</span> Waves</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org4842725" class="outline-3">
<h3 id="org4842725"><span class="section-number-3">2.1.</span> Wave on x-axis</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Consider a wave on x-axis: \(\mathrm{e}^{- \boldsymbol{k} \boldsymbol{x}}\), aka, \(\cos x\).
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org28458d9">(-&gt;o (fc size :scale scale :center t)
  (cos (x *))
  output)
</pre>
</div>


<div id="org825681e" class="figure">
<p><img src="./img/waves-x.png" alt="waves-x.png" />
</p>
<p><span class="figure-number">Figure 1: </span>pattern of \(\cos x\) (<code>size = 200</code>, <code>scale = 2</code>)</p>
</div>

<p>
<b>Explanation</b>:
</p>
<ul class="org-ul">
<li><a href="#org1bea41c"><code>-&gt;o</code></a> is a wrapper of <code>(-&gt;* ... ensure-mlx-array-as-rgb-img (save :output output))</code></li>
<li><a href="#org0dfa6cf"><code>fc</code></a> generate a 2-D matrix of coordinates \(\left(\begin{matrix} x \\ y \end{matrix}\right)\),
and <a href="#org145c49f"><code>x</code></a> returns a 2-D matrix of \(x\)</li>
</ul>
</div>
</div>
<div id="outline-container-org29b9c09" class="outline-3">
<h3 id="org29b9c09"><span class="section-number-3">2.2.</span> Matrix that performs rotation transformation</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Considering the coordinates multiplied with the rotation matrix <a href="#orgc95635f"><code>rotate2d</code></a>:
\(\left(\begin{matrix} \cos \theta & -\sin \theta \\ \sin \theta & \cos \theta \end{matrix}\right) \left(\begin{matrix} x \\ y \end{matrix}\right)\), which is equal to appling a rotation transformation
on the original coordinates:
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org1581872">(-&gt;o (fc size :scale scale :center t)
  (cos (x (matmul (rotate2d (radians 30))
                  (expand-dims * -1))))
  output)
</pre>
</div>


<div id="orga6d65ed" class="figure">
<p><img src="./img/waves-rotate-x.png" alt="waves-rotate-x.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Rotation of \(30^{\circ}\) of coordinates</p>
</div>

<p>
<b>Explanation</b>:
</p>
<ul class="org-ul">
<li><a href="#orgc95635f"><code>rotate2d</code></a> generates the rotation matrix</li>
<li><code>matmul</code> is taking on the last two axis (axis <code>-2</code>, <code>-1</code>) by default,
so we should reshape the <code>fc</code> from <code>(H W 2)</code> into <code>(H W 2 1)</code> first (<code>expand-dims</code>)</li>
</ul>
</div>
</div>
<div id="outline-container-orgfa11f6f" class="outline-3">
<h3 id="orgfa11f6f"><span class="section-number-3">2.3.</span> Waves interference</h3>
<div class="outline-text-3" id="text-2-3">
<p>
If adding two waves together, it would generate a pattern of interference fringes:
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org783164a">(-&gt;o (fc size :scale scale :center t)
  (+ (cos (x (matmul (rotate2d (radians 30))
                     (expand-dims * -1))))
     (cos (x *)))
  output)
</pre>
</div>


<div id="org60e40f9" class="figure">
<p><img src="./img/waves-2x.png" alt="waves-2x.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Interference fringes of two waves</p>
</div>
</div>
</div>
<div id="outline-container-org0f2b845" class="outline-3">
<h3 id="org0f2b845"><span class="section-number-3">2.4.</span> The Waves</h3>
<div class="outline-text-3" id="text-2-4">
<p>
So, if adding multiple waves all together:
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org6908abc">(-&gt;o (loop :repeat repeat
           :with r := (rotate2d (atanh (/ 6 8)))
           :for  p := (expand-dims (fc size :scale scale :center t) -1)
             :then (@ r p)
           :for x := (x p)
           :for o := (cos x) :then (add o (cos x))
           :finally (return (reshape o (list size size))))
  output)
</pre>
</div>


<div id="org75e9f8c" class="figure">
<p><img src="./img/waves.png" alt="waves.png" width="200px" />
</p>
<p><span class="figure-number">Figure 4: </span>40 waves adding together, each rotating \(\tan^{-1} \frac{6}{8}\) (<code>size = 400</code>, <code>scale=0.8</code>)</p>
</div>

<details><summary>Note: you may try different repeating times to see how the wave pattern generates. </summary>

<ul class="org-ul">
<li><p>
<code>repeat = 10</code>
</p>


<div id="org07e0dcb" class="figure">
<p><img src="./img/waves-repeat10.png" alt="waves-repeat10.png" width="200px" />
</p>
<p><span class="figure-number">Figure 5: </span>10 waves adding together, each rotating \(\tan^{-1} \frac{6}{8}\) (<code>size = 400</code>, <code>scale=0.8</code>)</p>
</div></li>
<li><p>
<code>repeat = 20</code>
</p>


<div id="orgbfde4c4" class="figure">
<p><img src="./img/waves-repeat20.png" alt="waves-repeat20.png" width="200px" />
</p>
<p><span class="figure-number">Figure 6: </span>20 waves adding together, each rotating \(\tan^{-1} \frac{6}{8}\) (<code>size = 400</code>, <code>scale=0.8</code>)</p>
</div></li>
</ul>

</details>

<details><summary>The Original Shader</summary>
<p>
The original shader code is from <a href="https://x.com/XorDev/status/1702764934898024916">Waves</a>:
</p>

<div class="org-src-container">
<pre class="src src-c">for(vec2 p=FC.xy-r*.5,i;i.x++&lt;40.;o+=cos(p.x))p*=mat2(8,-6,6,8)*.1;
</pre>
</div>
</details>
</div>
</div>
</div>
<div id="outline-container-org88f9209" class="outline-2">
<h2 id="org88f9209"><span class="section-number-2">3.</span> Equinox</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgcfa060d" class="outline-3">
<h3 id="orgcfa060d"><span class="section-number-3">3.1.</span> Linear \(\Vert \boldsymbol{r} \Vert\)</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Recall that the <a href="#org0dfa6cf"><code>fc</code></a> give us a 2-D matrix of coordinates \(\left(\begin{matrix} x \\ y \end{matrix}\right)\),
so if we take <code>la:norm</code> on the coordinates, we'd get \(\Vert \boldsymbol{r} \Vert = \sqrt{x^2 + y^2}\):
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org0930b64">(-&gt;o (fc size :xmin (- scale) :xmax scale
              :ymin (- scale) :ymax scale)
  (la:norm * nil :axis -1)
  output)
</pre>
</div>


<div id="org3c4f193" class="figure">
<p><img src="./img/img-of-r.png" alt="img-of-r.png" />
</p>
<p><span class="figure-number">Figure 7: </span>Image of \(\Vert \boldsymbol{r} \Vert\)</p>
</div>

<p>
It's easy to spot that the center color value is <code>0</code>, resulting black color.
And it "literally" transforms into outter white color linearly <sup><a id="fnr.color-and-gamma" class="footref" href="#fn.color-and-gamma" role="doc-backlink">2</a></sup>.
</p>

<details><summary>How does <code>scale</code> parameter affect the output?</summary>
<div class="org-src-container">
<pre class="src src-lisp" id="org1ab8718">(-&gt;frame (i 30 output :framerate 6)
  (+ (* i ds) smin)                     ; scale
  (fc size :xmin (- *) :xmax *
           :ymin (- *) :ymax *)
  (la:norm * nil :axis -1))
</pre>
</div>


<div id="orgc288878" class="figure">
<p><img src="./img/img-of-r-by-scale.gif" alt="img-of-r-by-scale.gif" />
</p>
<p><span class="figure-number">Figure 8: </span><code>scale</code> from <code>0.5</code> to <code>3.5</code>, which controls the size of the sphere clipping radius</p>
</div>
</details>
</div>
</div>
<div id="outline-container-org18df6df" class="outline-3">
<h3 id="org18df6df"><span class="section-number-3">3.2.</span> Sphere</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Considering the shape of a sphere \(\boldsymbol{r}^2 = 1\), we could calculate the depth of the
sphere by \(\sqrt{1 - r^2}\), where \(r\) is the linear \(\Vert r \Vert\) we calculate previously.
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org26df0f5">(let ((p (fc size :xmin (- scale) :xmax scale
                  :ymin (- scale) :ymax scale)))
<span id="coderef-linear-r" class="coderef-off">  (-&gt;o (la:norm p nil :axis -1)         ; (linear-r)</span>
    (sqrt (abs (- 1 (square *))))       ; sqrt(1 - r^2)
<span id="coderef-invert-color" class="coderef-off">    (- 1 *)                             ; (invert-color)</span>
    output))
</pre>
</div>


<div id="org5c5714a" class="figure">
<p><img src="./img/img-of-sphere.png" alt="img-of-sphere.png" />
</p>
<p><span class="figure-number">Figure 9: </span>Image of sphere (with color inverted)</p>
</div>

<p>
<b>Explanation</b>:
</p>
<ul class="org-ul">
<li><a href="#coderef-linear-r" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-linear-r');" onmouseout="CodeHighlightOff(this, 'coderef-linear-r');"><code>(abs (- 1 (square *)))</code></a>: use <code>abs</code> to avoid negative <code>sqrt</code></li>
<li><a href="#coderef-invert-color" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-invert-color');" onmouseout="CodeHighlightOff(this, 'coderef-invert-color');"><code>(- 1 *)</code></a>: inverse the color</li>
</ul>
</div>
</div>
<div id="outline-container-org66ee64b" class="outline-3">
<h3 id="org66ee64b"><span class="section-number-3">3.3.</span> Lighting along y-axis</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-lisp" id="orgd5d78d1">(let ((p (fc size :xmin (- scale) :xmax scale
                  :ymin (- scale) :ymax scale)))
  (-&gt;o (la:norm p nil :axis -1)
    (- 1 (sqrt (abs (- 1 (square *)))))
<span id="coderef-sphere-y" class="coderef-off">    (* (y p) *)                         ; (sphere-y)</span>
<span id="coderef-sphere-offset" class="coderef-off">    (sin (+ offset *))                  ; (sphere-offset)</span>
    output))
</pre>
</div>


<div id="org34873fc" class="figure">
<p><img src="./img/sphere-y-lighting.png" alt="sphere-y-lighting.png" />
</p>
<p><span class="figure-number">Figure 10: </span>Sphere lighting on y-axis</p>
</div>

<p>
<b>Explanation</b>:
</p>
<ul class="org-ul">
<li><p>
<a href="#coderef-sphere-y" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-sphere-y');" onmouseout="CodeHighlightOff(this, 'coderef-sphere-y');"><code>(* (y p) *)</code></a> multiply the sphere by <a href="#org145c49f"><code>(y p)</code></a>,
which modifies the intensity of the sphere, resulting
</p>

<details><summary>Example for not using y-axis direction</summary>
<div class="org-src-container">
<pre class="src src-lisp" id="org41bf3b8">(let ((p (fc size :xmin (- scale) :xmax scale
                  :ymin (- scale) :ymax scale)))
  (-&gt;frame (i 60 output :framerate 10)
    (dot p p)
    (- 1 (sqrt (abs (- 1 *))))
<span id="coderef-sphere-dot-dirvec2" class="coderef-off">    (* (dot (dirvec2 (* dt i)) p) *)    ; (sphere-dot-dirvec2)</span>
    (sin (+ offset *))))
</pre>
</div>


<div id="org7b58b4f" class="figure">
<p><img src="./img/sphere-any-direction-lighting.gif" alt="sphere-any-direction-lighting.gif" />
</p>
<p><span class="figure-number">Figure 11: </span>Animation of different <code>theta</code> (<code>(dot (dirvec2 (* dt i)) p)</code>)</p>
</div>

<p>
Note that <a href="#coderef-sphere-dot-dirvec2" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-sphere-dot-dirvec2');" onmouseout="CodeHighlightOff(this, 'coderef-sphere-dot-dirvec2');"><code>(dot (dirvec2 #|theta|#) p)</code></a> generates patterns like <code>(y p)</code>.
<code>(y p)</code> is equal to calling <code>(dot (dirvec2 (radians 90)) p)</code>.
</p>

</details></li>
<li><p>
<a href="#coderef-sphere-offset" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-sphere-offset');" onmouseout="CodeHighlightOff(this, 'coderef-sphere-offset');"><code>(sin (+ offset *))</code></a>: the <code>offset</code> modifys the center position of colors,
and <code>sin</code> makes sure that the intensity of color is periodic.
</p>

<details><summary>How <code>offset</code> affects the result</summary>
<div class="org-src-container">
<pre class="src src-lisp" id="org6e9e57c">(let ((p (fc size :xmin (- scale) :xmax scale
                  :ymin (- scale) :ymax scale)))
  (-&gt;frame (i 60 output :framerate 10)
    (dot p p)
    (- 1 (sqrt (abs (- 1 *))))
    (* (y p) *)                         ; (dot dirvec2 sphere)
    (sin (+ (* dt i) *))))
</pre>
</div>


<div id="org4ba9578" class="figure">
<p><img src="./img/sphere-offset.gif" alt="sphere-offset.gif" />
</p>
<p><span class="figure-number">Figure 12: </span>Animation of different <code>offset</code> (<code>(* dt i)</code>)</p>
</div>

<p>
Note that \(\sin \theta < 0\ \mathrm{if}\ \theta \in [\pi, 2 \pi]\), which results in black image.
</p>
</details></li>
</ul>
</div>
</div>
<div id="outline-container-org9c8446a" class="outline-3">
<h3 id="org9c8446a"><span class="section-number-3">3.4.</span> The Equinox</h3>
<div class="outline-text-3" id="text-3-4">
<p>
An colorful RGB image can be considered as mixing of R, G, B channel grayscale
images <sup><a id="fnr.colorspace" class="footref" href="#fn.colorspace" role="doc-backlink">3</a></sup>. Thus we could generate a colorful pattern:
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="orgffbee05">(let* ((p      (fc size :xmin (- scale) :xmax scale
                        :ymin (- scale) :ymax scale))
       (sphere (- 1 (sqrt (abs (- 1 (dot p p))))))
       (light  (* (dot (dirvec2 (radians theta)) p) sphere))
<span id="coderef-equinox-rgb" class="coderef-off">       (rgb    (reshape (repeat light 3) (list size size 3)))) ; (equinox-rgb)</span>
  (-&gt;frame (i 60 output :framerate 10)
<span id="coderef-equinox-pharse" class="coderef-off">    (+ (* dt i) rgb #(4 5 6))           ; (equinox-pharse)</span>
    (sin *)))
</pre>
</div>


<div id="orge670bbf" class="figure">
<p><img src="./img/equinox.gif" alt="equinox.gif" />
</p>
<p><span class="figure-number">Figure 13: </span>The colored animation of Equinox</p>
</div>

<p>
<b>Explanation</b>
</p>
<ul class="org-ul">
<li><a href="#coderef-equinox-rgb" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-equinox-rgb');" onmouseout="CodeHighlightOff(this, 'coderef-equinox-rgb');"><code>(reshape (repeat light 3) (list size size 3))</code></a> the <code>light</code> is a 2-D grayscale image-like
<code>mlx-array</code>, repeating it triple times and reshape it like a RGB image of shape <code>(H W 3)</code></li>
<li><p>
<a href="#coderef-equinox-pharse" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-equinox-pharse');" onmouseout="CodeHighlightOff(this, 'coderef-equinox-pharse');"><code>(+ (* dt i) rgb #(4 5 6))</code></a> the <code>#(4 5 6)</code> is the pharse value \(\phi\) in \(\sin (x + \phi)\),
this will ensure that R, G, B colors are starting with different initial pharse
</p>

<p>
Note if you change RGB pharse to <code>#(0 0 0)</code> (same pharse), you would see a black and white
sphere animation &#x2013; not so cool.
</p></li>
</ul>

<details><summary>The Original Shader</summary>
<p>
The original shader code is from <a href="https://x.com/XorDev/status/1961150728262582560">Equinox</a>:
</p>

<div class="org-src-container">
<pre class="src src-c">vec2 p=(FC.xy*2.-r)/r.y;
o=sin(t+p.y*(1.-sqrt(abs(1.-dot(p,p))))+vec4(4,5,6,0));
</pre>
</div>
</details>
</div>
</div>
</div>
<div id="outline-container-org83ebf35" class="outline-2">
<h2 id="org83ebf35"><span class="section-number-2">4.</span> Appendix</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgb4c3bfd" class="outline-3">
<h3 id="orgb4c3bfd"><span class="section-number-3">4.1.</span> Package</h3>
<div class="outline-text-3" id="text-4-1">
<p>
This tutorial is based on <code>mlx-cl.tutorial.drawings</code> package,
which is generated by <a href="https://orgmode.org/manual/Extracting-Source-Code.html">org-tangle</a>.
</p>

<p>
The package depends on some additional external packages: <code>cl-str</code>.
You could load them via:
</p>

<div class="org-src-container">
<pre class="src src-lisp">(ql:quickload '(:str))
</pre>
</div>

<details><summary>The <code>drawings.lisp</code> overview</summary>
<div class="org-src-container">
<pre class="src src-lisp">;;;; drawings.lisp --- Just draw something for fun

(uiop:define-package #:mlx-cl.tutorial.drawings
  (:use :mlx-cl)
  (:local-nicknames (:la :mlx-cl.linalg)))

(in-package :mlx-cl.tutorial.drawings)

;;; Utils
(eval-when (:compile-toplevel :load-toplevel :execute)
  (defun filter-plist (plist &amp;rest keys)
    "Remove KEYS from PLIST.
  Return a new plist with KEYS removed. "
    (loop :for (key val) :on plist :by #'cddr
          :if (not (member key keys))
            :collect key :and :collect val))
  )

;;; Creating `mlx-array'
(defun fc (size &amp;key (w size) (h size) (scale 1) (center nil)
                  (xmin (if center (/ w -2 scale) 0))
                  (xmax (if center (/ w  2 scale) scale))
                  (ymin (if center (/ h -2 scale) 0))
                  (ymax (if center (/ h  2 scale) scale)))
  "Return gl_FragCoord (H W (x y)=2). "
  (destructuring-bind (x y)
      (meshgrid (linspace xmin xmax w :dtype :float32)
                (linspace ymax ymin h :dtype :float32))
    (stack x y :axis 2)))
(defun rotate2d (theta)
  "Generate a 2-D vector rotation matrix. "
  (stack (stack (cos theta) (- (sin theta)))
         (stack (sin theta) (cos theta))))

;;; Normalize `mlx-array'
(defun ensure-mlx-array-as-rgb-img (arr)
  "Ensure input ARR is (H W 3) `mlx-array' of dtype `:uint8'.
Return the formatted `mlx-array'.

Rule:
1. ARR :uint8   -&gt; ARR
   ARR :float32 -&gt; ARR*255
2. ARR (H W)    -&gt; (H W 3) ; repeat 3
   ARR (H W 3)  -&gt; ARR
   ARR (H W 4)  -&gt; (H W 3) ; RGB*A + RGB*(1-A)
"
  (declare (type mlx-array arr))
  (-&gt;* (ecase (dtype arr)
         (:uint8   (/ arr 255.0))
         (:float32 arr))
    (ecase (dim *)
      (2 (reshape (repeat * 3) `(,@(shape *) 3)))
      (3 (ecase (len * 2)
           (1 (reshape (repeat * 3) `(,@(shape * :axes #(0 1)) 3)))
           (3 arr)
           (4 (destructuring-bind (r g b a) (split * 4 :axis 2)
                (-&gt;* (clip a :max 1 :min 0)
                  (stack (* r *)
                         (* g *)
                         (* b *)
                         :axis 2)
                  (squeeze *)))))))
    (as-dtype (* * 255) :uint8)))
(defmacro x (fc)
  "Get X part of FC (gl_FragCoord.x). "
  `(at ,fc :* :* 0))

(defmacro y (fc)
  "Get Y part of FC (gl_FragCoord.y). "
  `(at ,fc :* :* 1))

;;; Arrows
(defmacro -&gt;o (expr &amp;body bodys-output)
  "Enhanced `-&gt;*' arrow to write image to OUTPUT.
Return OUTPUT file path.

Syntax:

    (-&gt;o EXPRS...
      OUTPUT)

Parameters:
+ EXPRS: chained expressions, see `-&gt;*'
+ OUTPUT: image output path"
  `(-&gt;* ,expr
     ,@(butlast bodys-output)
     (ensure-mlx-array-as-rgb-img *)
     (save * :output ,@(last bodys-output))))
(defmacro -&gt;frame ((i frames output &amp;rest keys
                    &amp;key (tmp "./tmp/animated%d.ppm")
                    &amp;allow-other-keys)
                   &amp;body body)
  "Enhanced `-&gt;*' arrow to write image of frames to OUTPUT as animation.
Return OUTPUT file path.

Syntax:

    (-&gt;frame (I FRAMES OUTPUT &amp;key) &amp;body)

Parameters:
+ I: variable bind of current frame id (starting from 0)
+ FRAMES: number of total frames
+ OUTPUT: path of output
+ TMP: pattern of temporary frame output (default \"./tmp/animated%2d.ppm\")
  the format rules should follow FFMPEG file input formatting convention
+ DEBUG: see `ffmpeg'
"
  (declare (type symbol i))
  (let ((res (gensym "RES"))
        (pat (gensym "PAT"))
        (out (gensym "OUT")))
    `(let ((,res ())
           (,pat (uiop:native-namestring ,tmp))
           (,out (uiop:native-namestring ,output)))
       (unwind-protect
            (dotimes (,i ,frames (ffmpeg ,pat ,out ,@(filter-plist keys :tmp)))
              (-&gt;o ,@body
                (let ((tmp (ffmpeg-fmt ,pat ,i)))
                  (push tmp ,res)
                  tmp))
              ;; this is used to avoid cache expanding too fast
              (gc-all))
         (dolist (tmp ,res) (uiop:delete-file-if-exists tmp))))))

;;;; drawings.lisp ends here
</pre>
</div>
</details>

<p>
You could find the full script at <a href="drawings.lisp">drawings.lisp</a>.
</p>
</div>
<div id="outline-container-org615b812" class="outline-4">
<h4 id="org615b812"><span class="section-number-4">4.1.1.</span> Utils</h4>
<div class="outline-text-4" id="text-4-1-1">
<ul class="org-ul">
<li><p>
<code>filter-plist</code>
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="orgddc19f7">(defun filter-plist (plist &amp;rest keys)
  "Remove KEYS from PLIST.
Return a new plist with KEYS removed. "
  (loop :for (key val) :on plist :by #'cddr
        :if (not (member key keys))
          :collect key :and :collect val))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgc7e17bf" class="outline-4">
<h4 id="orgc7e17bf"><span class="section-number-4">4.1.2.</span> Creating <code>mlx-array</code></h4>
<div class="outline-text-4" id="text-4-1-2">
<ul class="org-ul">
<li><p>
<code>fc</code> for <a href="https://registry.khronos.org/OpenGL-Refpages/gl4/html/gl_FragCoord.xhtml"><code>gl_FragCoord</code></a>
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org0dfa6cf">(defun fc (size &amp;key (w size) (h size) (scale 1) (center nil)
                  (xmin (if center (/ w -2 scale) 0))
                  (xmax (if center (/ w  2 scale) scale))
                  (ymin (if center (/ h -2 scale) 0))
                  (ymax (if center (/ h  2 scale) scale)))
  "Return gl_FragCoord (H W (x y)=2). "
  (destructuring-bind (x y)
      (meshgrid (linspace xmin xmax w :dtype :float32)
                (linspace ymax ymin h :dtype :float32))
    (stack x y :axis 2)))
</pre>
</div>

<p>
<b>Explanation</b>:
</p>
<ul class="org-ul">
<li><code>(linspace start stop &amp;optional num)</code> return a <code>mlx-array</code> of <code>(NUM)</code> shape
with elements distributed linearly from <code>start</code> to <code>stop</code></li>
<li><code>(meshgrid arrays... &amp;key indexing spares)</code> generates multidimensional coordinate grids,
by default it use <code>:xy</code> as indexing method</li>
<li><a href="https://registry.khronos.org/OpenGL-Refpages/gl4/html/gl_FragCoord.xhtml"><code>gl_FragCoord</code></a> is origin at left-bottom, so you should notice that for y-coordinate,
it's <code>(linspace ymax ymin h)</code> (reversed as <code>mlx-array</code> is origin at left-top)</li>
</ul></li>
<li><p>
Rotation Matrix \(\left(\begin{matrix} \cos \theta & -\sin \theta \\ \sin \theta & \cos \theta \end{matrix}\right)\)
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="orgc95635f">(defun rotate2d (theta)
  "Generate a 2-D vector rotation matrix. "
  (stack (stack (cos theta) (- (sin theta)))
         (stack (sin theta) (cos theta))))
</pre>
</div>

<p>
See <a href="#orga6d65ed">2</a> for an example of "rotation".
</p></li>
<li><p>
Rotated base vector for direction
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org7980e0a">(defun dirvec2 (theta)
  "Rotate #(1 0) by THETA (radians). "
  (stack (cos theta) (sin theta)))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org807a019" class="outline-4">
<h4 id="org807a019"><span class="section-number-4">4.1.3.</span> Normalize <code>mlx-array</code></h4>
<div class="outline-text-4" id="text-4-1-3">
<ul class="org-ul">
<li><p>
as RGB <code>mlx-array</code> (H W C)
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org7a35efe">(defun ensure-mlx-array-as-rgb-img (arr)
  "Ensure input ARR is (H W 3) `mlx-array' of dtype `:uint8'.
Return the formatted `mlx-array'.

Rule:
1. ARR :uint8   -&gt; ARR
   ARR :float32 -&gt; ARR*255
2. ARR (H W)    -&gt; (H W 3) ; repeat 3
   ARR (H W 3)  -&gt; ARR
   ARR (H W 4)  -&gt; (H W 3) ; RGB*A + RGB*(1-A)
"
  (declare (type mlx-array arr))
  (-&gt;* (ecase (dtype arr)
         (:uint8   (/ arr 255.0))
         (:float32 arr))
    (ecase (dim *)
      (2 (reshape (repeat * 3) `(,@(shape *) 3)))
      (3 (ecase (len * 2)
           (1 (reshape (repeat * 3) `(,@(shape * :axes #(0 1)) 3)))
           (3 arr)
           (4 (destructuring-bind (r g b a) (split * 4 :axis 2)
                (-&gt;* (clip a :max 1 :min 0)
                  (stack (* r *)
                         (* g *)
                         (* b *)
                         :axis 2)
                  (squeeze *)))))))
    (as-dtype (* * 255) :uint8)))
</pre>
</div></li>
<li><p>
Getting subpart of <code>mlx-array</code>
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org145c49f">(defmacro x (fc)
  "Get X part of FC (gl_FragCoord.x). "
  `(at ,fc :* :* 0))

(defmacro y (fc)
  "Get Y part of FC (gl_FragCoord.y). "
  `(at ,fc :* :* 1))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org4e0a436" class="outline-4">
<h4 id="org4e0a436"><span class="section-number-4">4.1.4.</span> Arrows</h4>
<div class="outline-text-4" id="text-4-1-4">
<ul class="org-ul">
<li><p>
chain-calling into single image
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org1bea41c">(defmacro -&gt;o (expr &amp;body bodys-output)
  "Enhanced `-&gt;*' arrow to write image to OUTPUT.
Return OUTPUT file path.

Syntax:

    (-&gt;o EXPRS...
      OUTPUT)

Parameters:
+ EXPRS: chained expressions, see `-&gt;*'
+ OUTPUT: image output path"
  `(-&gt;* ,expr
     ,@(butlast bodys-output)
     (ensure-mlx-array-as-rgb-img *)
     (save * :output ,@(last bodys-output))))
</pre>
</div></li>
<li><p>
chain-calling into animation
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org0552fc8">(defmacro -&gt;frame ((i frames output &amp;rest keys
                    &amp;key (tmp "./tmp/animated%d.ppm")
                    &amp;allow-other-keys)
                   &amp;body body)
  "Enhanced `-&gt;*' arrow to write image of frames to OUTPUT as animation.
Return OUTPUT file path.

Syntax:

    (-&gt;frame (I FRAMES OUTPUT &amp;key) &amp;body)

Parameters:
+ I: variable bind of current frame id (starting from 0)
+ FRAMES: number of total frames
+ OUTPUT: path of output
+ TMP: pattern of temporary frame output (default \"./tmp/animated%2d.ppm\")
  the format rules should follow FFMPEG file input formatting convention
+ DEBUG: see `ffmpeg'
"
  (declare (type symbol i))
  (let ((res (gensym "RES"))
        (pat (gensym "PAT"))
        (out (gensym "OUT")))
    `(let ((,res ())
           (,pat (uiop:native-namestring ,tmp))
           (,out (uiop:native-namestring ,output)))
       (unwind-protect
            (dotimes (,i ,frames (ffmpeg ,pat ,out ,@(filter-plist keys :tmp)))
              (-&gt;o ,@body
                (let ((tmp (ffmpeg-fmt ,pat ,i)))
                  (push tmp ,res)
                  tmp))
              ;; this is used to avoid cache expanding too fast
              (gc-all))
         (dolist (tmp ,res) (uiop:delete-file-if-exists tmp))))))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org9cf9b45" class="outline-4">
<h4 id="org9cf9b45"><span class="section-number-4">4.1.5.</span> FFMPEG</h4>
<div class="outline-text-4" id="text-4-1-5">
<ul class="org-ul">
<li><p>
Call <a href="https://www.ffmpeg.org">FFMPEG</a> command
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org0ce79a6">(defparameter *ffmpeg-vfs* (make-hash-table :test 'cl:equal)
  "Video filter of FFMPEG.
Key: file extension
Val: string as vf")

(defparameter *ffmpeg-vf* "")

(defun ffmpeg-vf (ext)
  (gethash ext *ffmpeg-vfs* *ffmpeg-vf*))

(defun def-ffmpeg-vf (ext vf)
  (setf (gethash ext *ffmpeg-vfs*) vf))

(defun ffmpeg (input output &amp;rest keys
               &amp;key debug (vf (ffmpeg-vf (pathname-type output))) (framerate 6)
               &amp;allow-other-keys)
  "Call external FFMPEG command.

Parameters:
+ INPUT: FFMPEG input
+ OUTPUT: FFMPEG output
+ DEBUG: t for debug, or `:debug-only'
+ other keys will be used for FFMPEG parameters
"
  (let ((cmd `("ffmpeg"
               "-y"
               ,@(when framerate `("-framerate" ,(format nil "~A" framerate)))
               "-i"  ,(uiop:native-namestring input)
               "-vf" ,vf
               ,@(loop :for (key val) :on (filter-plist keys :debug) :by #'cddr
                       :collect (format nil "-~(~A~)" key)
                       :collect (format nil "~A" val))

               ,(uiop:native-namestring output))))
    (cond ((eql debug t)           (uiop:run-program (print cmd)))
          ((eql debug :debug-only) (print cmd))
          (t                       (uiop:run-program cmd)))
    output))

(def-ffmpeg-vf "gif"
    (concatenate 'string
                 "split[s0][s1];"
                 "[s0]palettegen=max_colors=64[p];"
                 "[s1][p]paletteuse=dither=sierra2_4a"))
</pre>
</div></li>
<li><p>
FFMPEG input file formating
</p>

<div class="org-src-container">
<pre class="src src-lisp" id="org53f5f09">(defun decode-ffmpeg-fmt (string)
  "Decode STRING as Lisp `format' control string.
Return the control string. "
  (declare (type string string))
  (let ((pivot 0))
    (with-output-to-string (fmt)
      (ppcre:do-matches (start end "%(%|\\d*[dD])" string)
        (write-string (subseq string pivot start) fmt)
        (case (aref string (1+ start))
          (#\%       (write-char #\% fmt))
          ((#\d #\D) (write-string "~D" fmt))
          (#\0       (format fmt "~~~A,'0D" (subseq string (2+ start) (1- end))))
          (otherwise (format fmt "~~~AD"    (subseq string (1+ start) (1- end)))))
        (setf pivot end))
      (write-string (subseq string pivot) fmt))))

(defun ffmpeg-fmt (control-string &amp;rest args)
  "Format using FFMPEG CONTROL-STRING and ARGS.
Return a formatted string. "
  (apply #'format nil (decode-ffmpeg-fmt control-string) args))
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org9a00f45" class="outline-3">
<h3 id="org9a00f45"><span class="section-number-3">4.2.</span> Reference</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li><a href="https://www.xordev.com/arsenal">Xor's Shader Arsenal</a></li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.a-sad-story" class="footnum" href="#fnr.a-sad-story" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
this can also serve as a test for MLX-CL library at some points&#x2026;
In short, it works terribly great: the MLX library use a cache method for the
data exchange. So if you frequently calling massive data exchange without calling
<code>mlx:clear-cache</code>, it would easily eat up tons of memory. And thus i lost my previous
work of this tutorial&#x2026; ha, ha, &#x2026; ha. (not so funny)
</p>

<br>

<p class="footpara">
And another problem is that if frequently calling data exchange, which means coping
data twice in both MLX (FFI) and Lisp. That's tooooooo mean to my poor M2 (8GB) Air.
Currently (at the time I wrote this tutorial, maybe later in the future), you may need
to call <code>mlx:clear-cache</code> manually to free the cache. Seems to be that MLX is not so
actively freeing up it's memory?
</p></div></div>

<div class="footdef"><sup><a id="fn.color-and-gamma" class="footnum" href="#fnr.color-and-gamma" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
there's a few notes on this:
if you read the <a href="#org7a35efe"><code>ensure-mlx-array-as-rgb-img</code></a> implementation,
you would notice that for the <code>mlx-array</code> of shape <code>(H W 1)</code>,
I just repeat it triple times to generate RGB color channels,
which is often called linear RGB color model. It's easy to implement,
but not a model that correctly matches with human's eye &#x2013; the value
is linearly increasing, while your eye is not thinking so.
</p>

<br>

<p class="footpara">
Well, it would not be too hard to implement <code>:srgb</code> colorspace in <a href="../../image/"><code>mlx-cl.image</code></a>.
Since this tutorial is not based on <code>mlx-cl/image</code> subsystem
<del>I haven't finished that yet actually</del>, just using RGB is fine.
</p>

<br>

<p class="footpara">
Oh, all most forgot, if you spot the corner of the <a href="#org3c4f193">output image</a>,
which should be \(\Vert \boldsymbol{r} \Vert = \sqrt{2} \approx 1.414 > 1\). So the value is clipped while
generating image output.
</p></div></div>

<div class="footdef"><sup><a id="fn.colorspace" class="footnum" href="#fnr.colorspace" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
You could view the documentation of <a href="../../image/colors/"><code>mlx-cl.image</code></a>.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: 凉凉</p>
<p class="date">Created: 2025-11-20 Thu 18:09</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
